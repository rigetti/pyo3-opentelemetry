[tasks.python-install-dependencies]
  private = true
  script = "poetry install"

[tasks.python-build]
  private = true
  dependencies = ["python-install-dependencies"]
  script = '''
  poetry run maturin develop
  poetry run black pyo3_opentelemetry_lib/_tracing_subscriber
  poetry run ruff pyo3_opentelemetry_lib/_tracing_subscriber --fix
  '''
    
[tasks.python-format]
  dependencies = ["python-build"]
  script = '''
  poetry run black .
  poetry run ruff . --fix
  '''

[tasks.python-check]
  dependencies = ["python-build"]
  script = '''
  poetry run black . --check
  poetry run ruff .
  poetry run pyright .
  '''

[tasks.python-test]
  dependencies = ["python-build"]
  script = '''
  poetry run pytest .

  PYTEST_FORCE=1 poetry run pytest 'pyo3_opentelemetry_lib/test/tracing_test.py::test_file_export[<lambda>2]'
  PYTEST_FORCE=1 poetry run pytest 'pyo3_opentelemetry_lib/test/tracing_test.py::test_file_export[<lambda>3]'
  PYTEST_FORCE=1 poetry run pytest 'pyo3_opentelemetry_lib/test/tracing_test.py::test_file_export_async[<lambda>0]'
  PYTEST_FORCE=1 poetry run pytest 'pyo3_opentelemetry_lib/test/tracing_test.py::test_file_export_async[<lambda>1]'

  PYTEST_FORCE=1 poetry run pytest 'pyo3_opentelemetry_lib/test/tracing_test.py::test_otlp_export[config2]'
  PYTEST_FORCE=1 poetry run pytest 'pyo3_opentelemetry_lib/test/tracing_test.py::test_otlp_export[config3]'
  PYTEST_FORCE=1 poetry run pytest 'pyo3_opentelemetry_lib/test/tracing_test.py::test_otlp_export_async[config0]'
  PYTEST_FORCE=1 poetry run pytest 'pyo3_opentelemetry_lib/test/tracing_test.py::test_otlp_export_async[config1]'
  '''

[tasks.python-check-all]
  dependencies = ["python-check", "python-test"]

